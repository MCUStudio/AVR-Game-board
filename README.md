# Библиотека для платы AVR Game board
Плата **AVR Game board** это Arduino совместимое устройство на микроконтроллере ATmega328 в форм-факторе игровой консоли. Плата разработана для обучения программированию игровых сценариев. Программирование платы осуществляется при помощи Arduino IDE и специализированной библиотеки. Библиотека поддерживает все основные функции по работе с железом, при использовании библиотеки написание программного кода полностью сосредотачивается на логике игрового сценария, визуализации сцены.

Для формирования игрового сценария плата **AVR Game board** предоставляет следующие модули, размещенные на плате:
- основной дисплей из светодиодной матрицы размером 8x16 точек;
- трехсимвольный семисегментный индикатор;
- 6 кнопок управления, включа четыре кнопки направления, кнопка FIRE, кнопка RETURN;
- зуммер для воспроизведения звуков.

Управление всеми перечисленными модулями реализовано в библиотеке для Arduino IDE. Поддержка перечисленных модулей разделена в библиотеке на три отдельные группы, которые являются совершенно независимыми:
- отображение;
- клавиатура;
- звук.

## Инициализация
Подключение библиотеки для **AVR Game board** осуществляется в два этапа. Первый - это собственно команда препроцессора для подключения библиотеки `#include <AvrGameBoard.h>`. Второй - это в процедуре setup() инициализация класса библиотеки `GameBoard.begin ()`.
```
#include <AvrGameBoard.h>

void setup() {
  GameBoard.begin (); 
}

void loop() {
}
```


## Oтображение
Светодиодная матрица и семисегментный индикатор объединены в единую систему формирования изображения. Для формирования изображения используются два массива байтов. Массив для светодиодной матрицы состоит из 16 байт `GameBoard.matrix[0..15]`. Массив для семисегментного индикатора состоит из 3-х байт `GameBoard.digit[0..2]`. Формирование изображения сводится к заполнению этих массивов необходимыми данными. Сама по себе запись данных в массивы не изменяет отображаемых данных на дисплеях. Что бы заполненные данные из обоих массивов отобразились, необходимо выполнить команду `GameBoard.show()`.

`GameBoard.show()` - переносит данные из массивов `GameBoard.matrix[0..15]` и `GameBoard.digit[0..2]` в дисплеи для их отображения.

## Oтображение на светодиодной матрице
Массив `GameBoard.matrix[0..15]` содержит 16 байт данных, каждый байт соответствует одной строке на дисплее. Всего на дисплее 16 строк. Cамая нижняя строка соответствует нулевой ячейке массива `GameBoard.matrix[0]`. Каждая ячейка массива содержит один байт данных, или 8 бит. Каждяй бит будет определять, будет ли светиться соответствующий светодиод в строке из 8-и светодиодов. Например для включения правого светодиода в строке, в соответствующую ячейку массива необходимо записать значение 0x01, для левого 0x80, для свечения всей строки 0xff в шестнадцатиричной системе счисления.

Ниже приведен простой пример включения и выключения правого нижнего светодиона с периодичностью в 1 секунду:
```
void loop() {
  GameBoard.matrix[0] = 1;
  GameBoard.show ();
  delay (500);
  GameBoard.matrix[0] = 0;
  GameBoard.show ();
  delay (500);
}
```
Дополнительные функции для отображение на светодиодной матрице:

`GameBoard.clearMatrix ()` - очищает данные в массиве `GameBoard.matrix[0..15]` выставляя все значения в 0.
`setMatrixIntensity (uint8_t v)` - устанавливает яркость отображения для всей светодиодной матрицы. Параметр функции v может изменяться от 0 до 15, где 0 соответствует полному затемнению отображения. Установка яркости происходит в момент вызова функции `GameBoard.show()`

## Oтображение на семисегментных индикаторах

Массив `GameBoard.digit[0..2]` содержит три байта данных для отображения информации на трех семисегментных индикаторах. Элемент массива с индексом 0 `GameBoard.digit[0]` соответствует правому индикатору. Каждый бит данных массива соответствует одному светодиодному элементу на индикаторе. Вы можете выводить изображения не только цифр, но и любых элементов, в так же включать сегменты по отдельности.
Например ниже приведен код, который производит включение и выключение нижних сегментов на всех трех индикаторах:
```
void loop() {
  GameBoard.digit[0] = 1;
  GameBoard.digit[1] = 1;
  GameBoard.digit[2] = 1;
  GameBoard.show ();
  delay (500);
  GameBoard.digit[0] = 0;
  GameBoard.digit[1] = 0;
  GameBoard.digit[2] = 0;
  GameBoard.show ();
  delay (500);
}
```
Для вывода цифровых изображений на семисегментные индикаторы используются дополнительные функции библиотеки.

`setDigitChar (uint8_t n, uint8_t ch)` используется для записи в массив `GameBoard.digit[n]` данных, соответствующих отображению цифры `ch` в интервале от 0 до 9, а так же дополнительных символов в интервале от 10 до 14. Значение 15 соответствует выключению всех сегментов индикатора.

Поддерживается 16 градаций яркости отдельно для светодиодной матрицы и семисегментного индикатора.

## Клавиатура
Библиотека постоянно опрашивает состояние кнопок и производит фильтрацию от дребезга контактов. В вашем сценарии вам достаточно выполнить запрос к библиотеке что бы определить состояние кнопок. Вы можете использовать один из двух режимов предоставления информации о нажатии кнопок: текущее состояние и события нажатия.

